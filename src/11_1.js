import { log } from './util/helpers.js';

let input = `.......#.....#.....................#.............#.................#.........................#..............................................
#.....................#.......#.................................................................................#.......#...................
.......................................................................#.........................#..................................#.......
................................................................#..............#..............................................#.............
.........................................#............................................................#....................................#
.................#..................................................#.......................................................................
...........................#...............................................................................#................................
....#.......#...........................................#..........................#.............................#..........................
....................#.............#........#................................................................................................
...................................................#...................................................#...................#................
.........................#........................................#..................................................#......................
......#..........#...........................................#...........#............#.....................................................
......................................#..........................................#.........................#.....................#..........
.#...................#..................................#.......................................#...........................................
............#.................................#.....................#.......................................................................
............................................................................................................................................
..............................#.....................................................................................#..................#....
....................................................................................#........#......#.......................................
.........................#.........................#............#...........................................#...............................
.#......#.....#.......................#.................#........................................................#.....#....................
...........................................................................#.................................................#..............
...............................................#.......................................#...............#..........................#.........
......................#..................#..................................................................................................
..........................................................................................................................#.................
......#...........................#.........................................................#........................#......................
..............................................................................................................................#.............
..#.......................#.................#............................................................................................#..
..................#....................................................#................#...................................................
....................................................#.....#....................#............................................................
...............................#............................................................................................................
..............................................#...............#..........................................................#...........#......
.#.........#........................#..................................................................#....................................
..........................................................................#.......................#........................................#
...................#......................................................................#.................................................
.............................................................................................................................#..............
.....#......................................................................................................................................
........................................................#........................#..........................................................
.............................#...............#.....................#.....#............#..................#..............................#...
............................................................................................#......#...........#............................
.........................#........#...................................................................................#.....................
...........................................................................................................................................#
.....................................................#.....#.................................................................#..............
#.........................................................................................................#.......................#.........
................#...........................................................#.....................#.........................................
..............................#..............#...................................#.......#...........................#......................
........#................#.........#............................#............................................#.............#.........#......
............................................................................................................................................
.......................................................#...............#.............................#...........................#..........
.............#.................................#............................................................................................
............................................................................................................................................
..#.............................................................................#...........................................#...........#...
............................................................................................................................................
......................................#..........................................................#................#.........................
............................#................#......#......................#...........#....................................................
............................................................................................................................................
....................................................................................................#................#..........#...........
.#............#...................#...............................#........................................#.............................#..
.........#...............................................................#..................................................................
.......................#....................#........#...........................................#..........................................
............................................................#.....................................................#.........................
..............................#.......................................................................#...................#.......#.........
............#.......................#...................#............................#......................................................
...................................................#......................................#..............................................#..
.#................#...................................................#........................#............................................
......#....................................................................#................................#...............................
...............................#....................................................................................#.......................
.........................#.....................#......#.............................................#.................................#.....
............................................................................................................................................
...............#.....................#....................................................#.................................................
..................................................................................................................#.........................
....#......#.....................................#..............................#............................#............#.....#...........
....................#.............................................#....................#.........#.......................................#..
.........................................................#..............#.............................#.....................................
............................#...........#...........................................................................#.......................
............................................................................................................................................
#..................................#...............................................................#..........#.............................
.......#......................................................................................#.................................#.......#...
.....................#....................#...............................#.....#......................................#....................
................................#..........................#......#....................#..........................#.........................
..............#...................................#........................................................................#...............#
....#....................................................................................................#..................................
.......................#....................................................................................................................
......................................#................................#..................#.................................................
.....................................................#............................................#...............................#.........
............................................................................................................................................
............................................................................................................................................
....#.................#..................................#.........................#..........................#.............................
.............#........................................................................................#..................#..................
......................................#............................................................................#........................
.........#....................................................#.........#............................................................#......
.............................................................................................#..............................................
.............................#...........#............................................................................#.....................
#..................#................................................#....................#.......................................#.........#
...................................................................................................#......#.................................
...........#.............................................#...........................#......................................................
....................................#.......................................................................................................
..................................................#..........#.........#......................#.....................#.......................
.#......#....................................#..............................................................#...............................
.............................#.............................................#................................................................
.......................#...............................................................................#....................#...............
....................................................#.....................................#...........................................#.....
................#.....................#..................#.................................................................................#
...#.....#..........................................................#................#......................................................
.............................................#...............#................................#......#......................................
...............................#...............................................#............................................................
.............................................................................................................................#.........#....
.....................#................................................#.................................................#...................
...............#.........................#.......................#..................#.......................................................
.....#......................................................................................................#.......................#.......
....................................#.................#.........................#..................#........................................
........................................................................................................................................#...
.........#..............#.....................................#........................................#.....................#..............
...............................................#...................#........................................................................
......................................#.............#..................................#.....#.......................#......................
............#.....#...............................................................................#.........................................
...#...................................................................................................................................#....
.......................#.........................#..........................................................................................
.........................................................#...........#.........................#........#..........#.............#..........
............................#..............#....................#........................................................#..................
.......#.................................................................#................#.................................................
.................#..................................................................................#........................#...........#..
...................................................#.......#................................................................................
.........................................#......................................#......................................#....................
....................................#...........................................................................#...........................
..............................#.............................................................#...........#.......................#......#....
.........#...............................................#..............#...................................................................
........................#....................#.....................................#........................................................
#...........................................................................................................................................
............................#......................................................................#.......#................................
......................................#.....................................................................................................
.....#............#.........................................#..........................#..........................................#.........
...........................................#......................#..............................................#..........................
..............#..............................................................................#............................#.............#...
..#......#...........................................#..............................#..................#.....#..............................
....................#..........#.....#...............................#......................................................................
............................................................................................................................................
.................................................#..........................................................................................
.............#..........#...............................#...............#.............#..........#.........#........#.......................
............................................#................#.................#............................................................
....................................#....................................................................................#.............#....`;

input = input.split('\n').map((row) => row.split(''));

/**
 * Parses a 2D grid input from a string array format into an array of objects,
 * where each object contains the character value and its coordinates in the grid.
 *
 * @param {string[]} input - An array of strings representing the grid,
 * where each string is a row of characters.
 *
 * @returns {{ value: string, coordinates: [number, number] }[][]}
 * A 2D array where each element is an object containing the character value and its coordinates.
 */
function extractGalaxyCoordinates(input) {
  let parsedInput = {};
  let galaxyCounter = 1;

  input.forEach((row, rowIndex) => {
    row.forEach((char, colIndex) => {
      if (char === '#') {
        parsedInput[galaxyCounter] = [rowIndex, colIndex];
        galaxyCounter++;
      }
    });
  });

  return parsedInput;
}

function findNoGalaxyRowsAndColumns(input) {
  const noGalaxyRows = [];
  const noGalaxyColumns = [];

  for (let i = 0; i < input.length; i++) {
    const row = input[i];
    const isGalaxyInARow = row.some((char) => char === '#');
    if (!isGalaxyInARow) {
      noGalaxyRows.push(i);
    }

    for (let j = 0; j < input.length; j++) {
      const col = input[j][i];

      if (col === '#') {
        break;
      }

      if (j === input.length - 1) {
        noGalaxyColumns.push(i);
      }
    }
  }

  return { noGalaxyColumns, noGalaxyRows };
}

function expand(universe, { noGalaxyColumns: cols, noGalaxyRows: rows }) {
  const newUniverse = universe.map((row) => [...row]);
  const rowLength = newUniverse[0].length;

  // Sort rows in descending order to avoid issues with shifting indices
  const sortedRows = [...new Set(rows)].sort((a, b) => b - a);

  sortedRows.forEach((index) => {
    const newRow = new Array(rowLength).fill('.');
    newUniverse.splice(index, 0, newRow);
  });

  // Sort cols in descending order to avoid issues with shifting indices
  const sortedCols = [...new Set(cols)].sort((a, b) => b - a);

  sortedCols.forEach((colIndex) => {
    newUniverse.forEach((row) => {
      row.splice(colIndex, 0, '.'); // Insert column in each row
    });
  });

  return newUniverse;
}

function calculateDistance([x1, y1], [x2, y2]) {
  return Math.abs(x1 - x2) + Math.abs(y1 - y2);
}

function findAllDistances(coordinates) {
  let distances = {};

  for (const [key1, coordinate1] of Object.entries(coordinates)) {
    for (const [key2, coordinate2] of Object.entries(coordinates)) {
      if (key1 === key2) {
        continue;
      }
      const distance = calculateDistance(coordinate1, coordinate2);
      const keyA = key1 + key2;
      const keyB = key2 + key1;
      if (keyA in distances) {
        distances[keyA] = distance;
      } else if (keyB in distances) {
        distances[keyB] = distance;
      } else {
        distances[keyA] = distance;
      }
    }
  }
  return distances;
}

function sum(distances) {
  return Object.values(distances).reduce((acc, curr) => {
    return acc + curr;
  }, 0);
}

const noGalaxyRowsAndColumns = findNoGalaxyRowsAndColumns(input);
const expandedUniverse = expand(input, noGalaxyRowsAndColumns);
log(expandedUniverse.map((a) => a.join('')));
const galaxiesCoordinates = extractGalaxyCoordinates(expandedUniverse);
const distances = findAllDistances(galaxiesCoordinates);
const result = sum(distances);

log(result);
